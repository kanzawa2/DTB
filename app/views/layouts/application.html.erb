<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= content_for?(:title) ? yield(:title) : "DTB" %></title>
    <%= csrf_meta_tags %>

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.1/html5shiv.js" type="text/javascript"></script>
    <![endif]-->

    <%= stylesheet_link_tag "application", :media => "all" %>

    <!-- For third-generation iPad with high-resolution Retina display: -->
    <!-- Size should be 144 x 144 pixels -->
    <%= favicon_link_tag 'apple-touch-icon-144x144-precomposed.png', :rel => 'apple-touch-icon-precomposed', :type => 'image/png', :sizes => '144x144' %>

    <!-- For iPhone with high-resolution Retina display: -->
    <!-- Size should be 114 x 114 pixels -->
    <%= favicon_link_tag 'apple-touch-icon-114x114-precomposed.png', :rel => 'apple-touch-icon-precomposed', :type => 'image/png', :sizes => '114x114' %>

    <!-- For first- and second-generation iPad: -->
    <!-- Size should be 72 x 72 pixels -->
    <%= favicon_link_tag 'apple-touch-icon-72x72-precomposed.png', :rel => 'apple-touch-icon-precomposed', :type => 'image/png', :sizes => '72x72' %>

    <!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: -->
    <!-- Size should be 57 x 57 pixels -->
    <%= favicon_link_tag 'apple-touch-icon-precomposed.png', :rel => 'apple-touch-icon-precomposed', :type => 'image/png' %>

    <!-- For all other devices -->
    <!-- Size should be 32 x 32 pixels -->
    <%= favicon_link_tag 'favicon.ico', :rel => 'shortcut icon' %>

    <%= javascript_include_tag "application" %>
  </head>
  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="/welcome#index">DTB</a>
          <div class="container-fluid nav-collapse">
            <ul class="nav">
              <li>
                <div class="dropdown">
                  <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown">
                    Mission
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                    <li role="presentation"><%= link_to "List", "/missions" %></li>
                    <li role="presentation"><%= link_to "Calendar", "/missions/calendar" %></li>
                    <li role="presentation"><%= link_to "Tree", "/missions/tree" %></li>
                  </ul>
                </div>
              </li>
              <li>
                <div class="dropdown">
                  <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown">
                    Task
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu2">
                    <li role="presentation"><%= link_to "List", "/tasks" %></li>
                    <li role="presentation"><%= link_to "Organize", "/tasks/organize" %></li>
                  </ul>
                </div>
              </li>
              <li>
                <div class="dropdown">
                  <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu3" data-toggle="dropdown">
                    TimeEntry
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu3">
                    <li role="presentation"><%= link_to "List", "/time_entries" %></li>
                    <li role="presentation"><%= link_to "Organize", "/time_entries/organize" %></li>
                  </ul>
                </div>
              </li>
              <li>
                <div class="dropdown">
                  <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu4" data-toggle="dropdown">
                    History
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu4">
                    <li role="presentation"><%= link_to "List", "/unified_histories" %></li>
                    <li role="presentation"><%= link_to "Organize", "/unified_histories/organize" %></li>
                  </ul>
                </div>
              </li>
              <li>
                <div class="dropdown">
                  <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu5" data-toggle="dropdown">
                    Sync
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu5">
                    <% today = Time.now.beginning_of_day %>
                    <li role="presentation"><%= link_to "day", {controller: "time_entries", action: "sync", start: today.to_s(:fulltime)}, {method: :post} %></li>
                    <li role="presentation"><%= link_to "week", {controller: "time_entries", action: "sync", start: (today - 1.week).to_s(:fulltime)}, {method: :post, data: {confirm: "This action is too long. Are you sure?"}} %></li>
                    <li role="presentation"><%= link_to "month", {controller: "time_entries", action: "sync", start: (today - 1.month).to_s(:fulltime)}, {method: :post, data: {confirm: "This action is too long. Are you sure?"}} %></li>
                    <li role="presentation"><%= link_to "all", {controller: "time_entries", action: "sync"}, {method: :post, data: {confirm: "This action is too long. Are you sure?"}} %></li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid">
        <div class="row">
          <div class="span4">
            <div class="sidebar">
              <ul class="nav">
                <li>
                  <div class="input-append">
                    <% if TimeEntry.current.nil? %>
                      <%= form_tag( { controller: "time_entries", action: "continue"} ) do %>
                        <%= text_field_tag "name", nil, placeholder: "What are you doing?" %>
                        <button type="submit" class="btn btn-success">Start</button>
                      <% end %>
                    <% else %>
                      <%= form_tag( { controller: "time_entries", action: "stop" } ) do %>
                        <%= text_field_tag "name", TimeEntry.current.name, readonly: true %>
                        <button type="submit" class="btn btn-danger">Stop</button>
                      <% end %>
                    <% end %>
                  </div>
                </li>
                <li>
                  <div class="input-append">
                    <%= form_tag( { controller: "tasks", action: "simple_create"} ) do %>
                      <%= text_field_tag "name", nil, placeholder: "Input new task" %>
                      <button type="submit" class="btn btn-success">Create</button>
                    <% end %>
                  </div>
                </li>
                <li>
                  <h4>Mission Tree</h4>
                  <ul id="mission_tree" class="treeview">
                    <% @root_missions.each do |m| %>
                      <%= render :partial => "missions/tree_item", :locals => {:mission => m} %>
                    <% end %>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
          <div class="span8">
              <% flash.each do |name, msg| %>
                <div class="alert alert-<%= name %>">
                  <button type="button" class="close" data-dismiss="alert">Ã—</button>
                  <%= msg %>
                </div>
              <% end %>
              <%= yield %>
          </div>
        </div>
    </div>
  </body>
</html>
